<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>webã‚µã‚¤ã‚³ãƒ­</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      font-family: system-ui, sans-serif;
    }

    .scene {
      width: 110px;
      height: 110px;
      perspective: 800px;
    }

    .cube {
      width: 90px;
      height: 90px;
      position: relative;
      transform-style: preserve-3d;
      margin: auto;
      cursor: pointer;
    }

    .face {
      position: absolute;
      width: 90px;
      height: 90px;
      background: white;
      border-radius: 16px;
      border: 1px solid #ddd;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      display: flex;
      justify-content: center;
      align-items: center;
      backface-visibility: hidden;
    }

    /* å„é¢ã®é…ç½®ï¼ˆç«‹æ–¹ä½“ä¸­å¿ƒã‹ã‚‰ã®è·é›¢ã¯ 45pxï¼‰ */
    .f1 { transform: rotateY(0deg) translateZ(45px); }
    .f2 { transform: rotateY(90deg) translateZ(45px); }
    .f3 { transform: rotateY(180deg) translateZ(45px); }
    .f4 { transform: rotateY(-90deg) translateZ(45px); }
    .f5 { transform: rotateX(90deg) translateZ(45px); }
    .f6 { transform: rotateX(-90deg) translateZ(45px); }

    .pip {
      width: 14px;
      height: 14px;
      background: #111;
      border-radius: 9999px;
      position: absolute;
      /* ã©ã®ãƒ‰ãƒƒãƒˆã‚‚ â€œä¸­å¿ƒâ€ ã‚’æŒ‡å®šåº§æ¨™ã«åˆã‚ã›ã‚‹ */
      transform: translate(-50%, -50%);
    }

    /* å›è»¢ä¸­ï¼šä¸€å®šé€Ÿåº¦ */
    @keyframes spin3d {
      from { transform: rotateX(0deg) rotateY(0deg); }
      to   { transform: rotateX(720deg) rotateY(1080deg); }
    }
    .spinning {
      animation: spin3d 0.6s linear infinite;
    }

    /* æ¸›é€Ÿã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ­¢ã‚ã‚‹ã¨ãï¼‰*/
    @keyframes slowSpin3d {
      0%   { transform: rotateX(0deg) rotateY(0deg); }
      100% { transform: rotateX(720deg) rotateY(1080deg); }
    }
    .decelerating {
      animation: slowSpin3d 0.7s ease-out forwards;
    }
  </style>
</head>
<body class="bg-gray-100 p-6 flex flex-col items-center">

  <h1 class="text-3xl font-bold text-blue-600 mb-6">
    ğŸ² Webã‚µã‚¤ã‚³ãƒ­
  </h1>

  <!-- å€‹æ•°ãƒœã‚¿ãƒ³ï¼ˆ1ã€œ9ï¼‰ -->
  <div class="mb-6 flex gap-2 flex-wrap justify-center">
    <button class="countBtn px-4 py-2 bg-blue-100 rounded" data-n="1">1ã“</button>
    <button class="countBtn px-4 py-2 bg-blue-100 rounded" data-n="2">2ã“</button>
    <button class="countBtn px-4 py-2 bg-blue-100 rounded" data-n="3">3ã“</button>
    <button class="countBtn px-4 py-2 bg-blue-100 rounded" data-n="4">4ã“</button>
    <button class="countBtn px-4 py-2 bg-blue-100 rounded" data-n="5">5ã“</button>
    <button class="countBtn px-4 py-2 bg-blue-100 rounded" data-n="6">6ã“</button>
    <button class="countBtn px-4 py-2 bg-blue-100 rounded" data-n="7">7ã“</button>
    <button class="countBtn px-4 py-2 bg-blue-100 rounded" data-n="8">8ã“</button>
    <button class="countBtn px-4 py-2 bg-blue-100 rounded" data-n="9">9ã“</button>
  </div>

  <!-- ä¸€æ‹¬æ“ä½œ -->
  <div class="mb-6 flex gap-4">
    <button id="rollAll" class="px-6 py-3 bg-pink-500 text-white rounded-full">
      ğŸ”„ ã™ã¹ã¦æŒ¯ã‚‹
    </button>
    <button id="stopAll" class="px-6 py-3 bg-indigo-500 text-white rounded-full">
      âœ‹ ã™ã¹ã¦æ­¢ã‚ã‚‹
    </button>
  </div>

  <!-- ã‚µã‚¤ã‚³ãƒ­è¡¨ç¤ºï¼š3Ã—3 å›ºå®šã‚°ãƒªãƒƒãƒ‰ -->
  <div id="diceArea"
       class="grid grid-cols-3 gap-16 w-full max-w-md justify-items-center">
  </div>

<script>
const diceArea = document.getElementById("diceArea");
let diceList = [];  // { cube, isRolling }

function randomFace() {
  return Math.floor(Math.random() * 6) + 1;
}

function orientation(v) {
  return {
    1: "rotateX(0deg) rotateY(0deg)",      // æ­£é¢
    2: "rotateX(0deg) rotateY(-90deg)",    // å³
    3: "rotateX(0deg) rotateY(180deg)",    // èƒŒé¢
    4: "rotateX(0deg) rotateY(90deg)",     // å·¦
    5: "rotateX(-90deg) rotateY(0deg)",    // ä¸Š
    6: "rotateX(90deg) rotateY(0deg)",     // ä¸‹
  }[v];
}

// ã©ã®ãƒ‰ãƒƒãƒˆã‚‚ â€œä¸­å¿ƒâ€ ã‚’åŸºæº–ã«é…ç½®
function createPip(xPercent, yPercent) {
  const p = document.createElement("div");
  p.className = "pip";
  p.style.left = xPercent + "%";
  p.style.top  = yPercent + "%";
  return p;
}

function createFace(num) {
  const f = document.createElement("div");
  f.className = "face f" + num;

  // 20 / 50 / 80 % ã® 3Ã—3 ã‚°ãƒªãƒƒãƒ‰ä¸Šã«é…ç½®
  const layouts = {
    1: [[50,50]],
    2: [[25,25],[75,75]],
    3: [[25,25],[50,50],[75,75]],
    4: [[25,25],[75,25],[25,75],[75,75]],
    5: [[25,25],[75,25],[50,50],[25,75],[75,75]],
    6: [[25,25],[75,25],[25,50],[75,50],[25,75],[75,75]],
  };

  layouts[num].forEach(([x,y])=>{
    f.appendChild(createPip(x,y));
  });

  return f;
}

function createDice() {
  const scene = document.createElement("div");
  scene.className = "scene";

  const cube = document.createElement("div");
  cube.className = "cube";

  for (let i=1;i<=6;i++){
    cube.appendChild(createFace(i));
  }
  cube.style.transform = orientation(1);

  scene.appendChild(cube);

  let state = { cube, isRolling:false };

  // å€‹åˆ¥ã‚¿ãƒƒãƒ—ã§ãƒˆã‚°ãƒ«
  cube.addEventListener("click", ()=> toggleRoll(state));

  return {scene, state};
}

function renderDice(n) {
  diceArea.innerHTML = "";
  diceList = [];

  for (let i=0;i<n;i++){
    const {scene, state} = createDice();
    diceList.push(state);
    diceArea.appendChild(scene);
  }
}

// å›è»¢é–‹å§‹
function startRoll(state){
  if (state.isRolling) return;
  state.isRolling = true;

  state.cube.classList.remove("decelerating");
  void state.cube.offsetWidth;

  state.cube.classList.add("spinning");
}

// å›è»¢åœæ­¢ï¼ˆæ¸›é€Ÿâ†’ç›®ã§æ­¢ã‚ã‚‹ï¼‰
function stopRoll(state){
  if (!state.isRolling) return;
  state.isRolling = false;

  const finalValue = randomFace();
  const finalPose  = orientation(finalValue);

  state.cube.classList.remove("spinning");

  state.cube.classList.remove("decelerating");
  void state.cube.offsetWidth;
  state.cube.classList.add("decelerating");

  state.cube.addEventListener("animationend", function handler(e){
    if (e.animationName === "slowSpin3d"){
      state.cube.classList.remove("decelerating");
      state.cube.style.transform = finalPose;
      state.cube.removeEventListener("animationend", handler);
    }
  });
}

function toggleRoll(state){
  if (state.isRolling) {
    stopRoll(state);   // å›è»¢ä¸­ â†’ æ­¢ã‚ã‚‹
  } else {
    startRoll(state);  // é™æ­¢ä¸­ â†’ å›ã™
  }
}

// å€‹æ•°ãƒœã‚¿ãƒ³
document.querySelectorAll(".countBtn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    renderDice(parseInt(btn.dataset.n));
  });
});

// åˆæœŸã¯ 6ã“ è¡¨ç¤º
renderDice(1);

// ä¸€æ‹¬æ“ä½œ
document.getElementById("rollAll").onclick = ()=>{
  diceList.forEach(state=> startRoll(state));
};

document.getElementById("stopAll").onclick = ()=>{
  diceList.forEach(state=> stopRoll(state));
};
</script>

</body>
</html>
